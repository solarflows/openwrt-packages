<%+cbi/valueheader%>
<input type="checkbox" id="checkbox1" checked><%:Auto refresh%></input>
<textarea id="logview" class="cbi-input-textarea" style="width: 100%" rows="30" readonly="readonly"></textarea>

<script type="text/javascript">
    const LOG_URL = '<%=luci.dispatcher.build_url("admin", "services", "cloudflarespeedtest","getlog")%>';

    let logPos = 0;

    function getlog() {
        XHR.get(LOG_URL + '?pos=' + encodeURIComponent(logPos), null, function(x, data) {
            // data is parsed JSON: { pos, content }
            const log_content = (data && data.content) || "";
            if (log_content.length > 0) {
                // append to existing text area content
                const lv = document.getElementById('logview');
                lv.value += log_content;
                lv.scrollTop = lv.scrollHeight;
            }

            if (data && data.pos !== undefined && data.pos !== null) {
                logPos = parseInt(data.pos, 10) || logPos;
            }
        });
    }
    getlog();
    setInterval(() => {
        if (document.getElementById("checkbox1").checked) getlog();
    }, 5000);
</script>
<%+cbi/valuefooter%>
